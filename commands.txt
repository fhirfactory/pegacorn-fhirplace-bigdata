(Run in cmd [Administrator mode] except where noted)

RUN THIS AS A SEPARATE COMMANDLINE!!!
Run the Alpine command to mount your volumes:
docker container run --rm -it -v /:/host alpine
chroot /host
***

# Build base images -- This was built and pushed to fhirfactory docker hub
docker build --rm -t pegacorn-base-hadoop:1.0.0 --file Dockerfile . // (PLS DO NOT RUN THIS COMMAND)
docker build --rm -t pegacorn-base-hbase:1.0.0 --file Dockerfile . // (PLS DO NOT RUN THIS COMMAND)
docker build --rm -t pegacorn-base-zookeeper:1.0.0 --file Dockerfile . // (PLS DO NOT RUN THIS COMMAND)

=====================================================================================================================================
# Deploy Hadoop Master Node (NameNode)
cd to namenode folder:
docker pull fhirfactory/pegacorn-base-hadoop:1.0.0
docker build --rm --build-arg IMAGE_BUILD_TIMESTAMP="%date% %time%" -t pegacorn-fhirplace-namenode:1.0.0-snapshot --file Dockerfile .

helm upgrade pegacorn-fhirplace-namenode-site-a --install --namespace site-a --set serviceName=pegacorn-fhirplace-namenode,hostPathNamenode=/data/hadoop-namenode,clusterName=Pegacorn,imageTag=1.0.0-snapshot,numOfPods=1 helm

Add the following to your hosts file (with Notepad [Adminstrator mode]) - C:\Windows\System32\drivers\etc
127.0.0.1 pegacorn-fhirplace-namenode.site-a

To view HDFS Web:
http://pegacorn-fhirplace-namenode.site-a:9870

# Deploy Worker Nodes (DataNodes)
cd to datanode folder:
docker build --rm --build-arg IMAGE_BUILD_TIMESTAMP="%date% %time%" -t pegacorn-fhirplace-datanode:1.0.0-snapshot --file Dockerfile .

helm upgrade pegacorn-fhirplace-datanode-alpha-site-a --install --namespace site-a --set serviceName=pegacorn-fhirplace-datanode-alpha,hostPathDatanode=/data/hadoop-datanode-alpha,imageTag=1.0.0-snapshot,numOfPods=1 helm

helm upgrade pegacorn-fhirplace-datanode-beta-site-a --install --namespace site-a --set serviceName=pegacorn-fhirplace-datanode-beta,hostPathDatanode=/data/hadoop-datanode-beta,imageTag=1.0.0-snapshot,numOfPods=1 helm

Add the following to your hosts file (with Notepad [Adminstrator mode]) - C:\Windows\System32\drivers\etc
127.0.0.1 pegacorn-fhirplace-datanode-alpha.site-a
127.0.0.1 pegacorn-fhirplace-datanode-beta.site-a

================================================================================================================================================
# Hadoop Database setup -- In order of resource compliance

# Deploy Zookeeper Server (Zookeeper manages the HBase cluster)
cd to zookeeper folder:
docker pull fhirfactory/pegacorn-base-zookeeper:1.0.0
docker build --rm --build-arg IMAGE_BUILD_TIMESTAMP="%date% %time%" -t pegacorn-fhirplace-zookeeper:1.0.0-snapshot --file Dockerfile .

helm upgrade pegacorn-fhirplace-zookeeper-site-a --install --namespace site-a --set serviceName=pegacorn-fhirplace-hbase-zookeeper,imagePullPolicy=Never,basePort=32310,hostPathZKData=/data/zookeeper-data,imageTag=1.0.0-snapshot,numOfPods=1 helm

# Deploy HBase Master server (HBase master is the management server for Hbase Region clusters)
cd to hmaster folder:
docker pull fhirfactory/pegacorn-base-hbase:1.0.0
docker build --rm --build-arg IMAGE_BUILD_TIMESTAMP="%date% %time%" -t pegacorn-fhirplace-hbase-master:1.0.0-snapshot --file Dockerfile .

helm upgrade pegacorn-fhirplace-hbase-master-site-a --install --namespace site-a --set serviceName=pegacorn-fhirplace-hbase-master,imagePullPolicy=Never,basePort=32410,hostPathHbMaster=/data/hbase-master,imageTag=1.0.0-snapshot,numOfPods=1 helm

Add the following to your hosts file (with Notepad [Adminstrator mode]) - C:\Windows\System32\drivers\etc
127.0.0.1 pegacorn-fhirplace-hbase-master.site-a

To view Hbase Web:
http://pegacorn-fhirplace-hbase-master.site-a:16010

# Deply Hbase Region servers - 2 pods
cd to hregionserver folder:
docker build --rm --build-arg IMAGE_BUILD_TIMESTAMP="%date% %time%" -t pegacorn-fhirplace-hbase-region:1.0.0-snapshot --file Dockerfile .

helm upgrade pegacorn-fhirplace-hbase-region-site-a --install --namespace site-a --set serviceName=pegacorn-fhirplace-hbase-region,imagePullPolicy=Never,basePort=32210,hostPathHbRegion=/data/hbase-region,imageTag=1.0.0-snapshot,numOfPods=4 helm
